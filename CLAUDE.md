# CLAUDE.md - AI Assistant Technical Guide

> Technical documentation for AI assistants working on the Feedback App

## Project Overview

This is a feedback collection web application built with Next.js 16 (App Router), React 19, TypeScript, and Supabase. The application allows anonymous users to submit feedback with a name (optional), 1-5 star rating, and message.

### Technology Stack

- **Framework**: Next.js 16.0.3 (App Router architecture)
- **UI Library**: React 19.2.0 with experimental React Compiler
- **Language**: TypeScript 5.x
- **Styling**: Tailwind CSS 4.x
- **Database**: Supabase (PostgreSQL with real-time features)
- **Package Manager**: npm
- **Linting**: ESLint 9 with Next.js config

## Architecture

### Directory Structure

```
feedback-app/
├── app/                          # Next.js App Router
│   ├── api/                      # API Routes
│   │   └── feedback/
│   │       └── route.ts          # POST endpoint for feedback submission
│   ├── page.tsx                  # Home page (Server Component)
│   ├── layout.tsx                # Root layout
│   └── globals.css               # Global styles (Tailwind)
├── components/                   # React Components
│   └── FeedbackForm.tsx          # Client-side feedback form
├── lib/                          # Shared utilities
│   └── supabaseClient.ts         # Supabase client singleton
├── .env.local                    # Environment variables (not in git)
├── tailwind.config.ts            # Tailwind configuration
└── tsconfig.json                 # TypeScript configuration
```

### Component Architecture

1. **app/page.tsx** (Server Component)
   - Renders the main layout and heading
   - Imports and renders FeedbackForm client component
   - Uses Tailwind for responsive layout

2. **components/FeedbackForm.tsx** (Client Component)
   - Marked with `'use client'` directive
   - Manages form state: name, rating, message, status
   - Handles form submission via fetch to `/api/feedback`
   - Shows success state or error messages
   - Uses controlled inputs for all fields

3. **app/api/feedback/route.ts** (API Route)
   - POST handler for feedback submission
   - Creates Supabase client per request
   - Validates environment variables
   - Inserts data into `feedback` table
   - Returns JSON response with success/error

4. **lib/supabaseClient.ts** (Utility)
   - Exports configured Supabase client
   - Uses environment variables from process.env
   - Includes warning for missing credentials (doesn't crash build)

### Data Flow

1. User fills form in FeedbackForm component
2. On submit: POST request to `/api/feedback` with JSON body
3. API route validates credentials and data
4. Supabase insert operation
5. Response sent back to client
6. UI updates based on success/error

## Database Schema

### `feedback` Table

```sql
create table feedback (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  name text,                    -- Optional user name
  rating integer,               -- 1-5 star rating
  message text                  -- User feedback message (required)
);
```

### Row Level Security (RLS)

- **Policy**: Anonymous insert access enabled
- **Justification**: Allows public to submit feedback without authentication
- **Security**: Read access restricted to authenticated users (default deny)

## Environment Variables

### Required Variables

```env
NEXT_PUBLIC_SUPABASE_URL=https://[project-id].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=[anon-key-from-supabase]
```

### Notes
- Prefixed with `NEXT_PUBLIC_` because they're used client-side
- Found in Supabase project settings → API
- Never commit `.env.local` to version control
- Missing variables will log warning but won't crash build

## Development Workflows

### Running Locally

```bash
npm install                  # Install dependencies
npm run dev                  # Start dev server on :3000
npm run build                # Production build
npm run lint                 # Run ESLint
```

### Common Tasks

#### Adding a New Form Field

1. Update the `feedback` table schema in Supabase
2. Add state in `FeedbackForm.tsx` (`useState`)
3. Add input field to form JSX
4. Include field in fetch body
5. Update API route to accept new field
6. Update TypeScript types if needed

#### Modifying Styles

- Tailwind classes are used throughout
- Global styles in `app/globals.css`
- Tailwind config in `tailwind.config.ts`
- Use existing Tailwind utility classes before adding custom CSS

#### Testing API Endpoints

```bash
curl -X POST http://localhost:3000/api/feedback \
  -H "Content-Type: application/json" \
  -d '{"name":"Test","rating":5,"message":"Great!"}'
```

### Code Conventions

1. **Client vs Server Components**
   - Use `'use client'` only when necessary (state, effects, event handlers)
   - Default to Server Components in App Router
   - Keep client components small and focused

2. **TypeScript**
   - Explicit types for props and state
   - Use TypeScript's built-in types (React.FormEvent, etc.)
   - No `any` types unless absolutely necessary

3. **Error Handling**
   - API routes should always return JSON
   - Use try-catch in async operations
   - Log errors to console for debugging
   - Show user-friendly messages in UI

4. **State Management**
   - Currently uses React useState (no external state library)
   - Component-level state only
   - Consider Context or Zustand if state becomes complex

## Current Limitations & Known Issues

1. **No Authentication**: Anyone can submit feedback (by design)
2. **No Rate Limiting**: Could be abused with spam submissions
3. **No Data Validation**: Client-side only (need server-side validation)
4. **No Admin Dashboard**: Must view feedback in Supabase dashboard
5. **Single Language**: No internationalization support

## Future Enhancement Considerations

See ROADMAP.md for planned features. When implementing new features:

- Maintain backward compatibility with existing feedback table
- Keep client bundle size minimal
- Follow existing code patterns and conventions
- Update both README.md and ROADMAP.md after completion

## Debugging Tips

### Common Issues

**"Supabase credentials missing" error**
- Check `.env.local` exists in project root
- Verify variable names match exactly: `NEXT_PUBLIC_SUPABASE_URL` and `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- Restart dev server after changing .env files

**Insert fails with RLS policy error**
- Verify RLS policies allow anonymous inserts
- Check Supabase Authentication → Policies
- Test policy with SQL Editor

**Form doesn't submit**
- Check browser console for errors
- Verify API route is responding (Network tab)
- Check Supabase table name matches exactly: `feedback`

### Useful Commands

```bash
# View environment variables (Next.js)
npm run dev -- --show-env

# Check TypeScript errors
npx tsc --noEmit

# Clear Next.js cache
rm -rf .next

# View Supabase logs
# Go to Supabase dashboard → Logs
```

## Dependencies

### Production Dependencies
- `next@16.0.3` - React framework
- `react@19.2.0` - UI library
- `react-dom@19.2.0` - React DOM renderer
- `@supabase/supabase-js@2.84.0` - Supabase client

### Dev Dependencies
- `typescript@5.x` - Type checking
- `@types/*` - TypeScript definitions
- `eslint@9.x` - Linting
- `tailwindcss@4.x` - Styling
- `babel-plugin-react-compiler@1.0.0` - React optimization

## Deployment

### Recommended: Vercel

1. Push code to GitHub
2. Import project in Vercel dashboard
3. Add environment variables in Vercel settings
4. Deploy automatically on push

### Alternative: Self-Hosted

```bash
npm run build
npm start
```

Requires Node.js 20+ and environment variables configured on the server.

## Testing Strategy

Currently no automated tests. Consider adding:
- **Unit Tests**: Jest + React Testing Library for components
- **Integration Tests**: Playwright for end-to-end flows
- **API Tests**: Supertest for API route testing

## Security Considerations

1. **Input Sanitization**: No sanitization currently - add if displaying feedback publicly
2. **SQL Injection**: Protected by Supabase parameterized queries
3. **XSS**: React escapes by default, but sanitize if adding innerHTML
4. **CORS**: Next.js API routes handle CORS automatically
5. **Environment Variables**: Never expose service_role key client-side

## Performance Notes

- Server Components reduce client bundle size
- React Compiler optimizes rendering (experimental)
- Supabase connection pooling handles concurrent requests
- Consider adding caching for read operations if needed

---

**Last Updated**: 2025-01-24
**Maintained By**: Development Team
**For Questions**: See README.md or project documentation
